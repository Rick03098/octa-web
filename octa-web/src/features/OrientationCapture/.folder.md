# /src/features/OrientationCapture/.folder.md

## 地位（Role）
特征层的方向获取页面组件，连接拍摄完成页面和加载页面，提供设备方向检测和稳定度判断功能。

## 逻辑（Logic）
- **初始指引**: 页面加载时先展示纯文案指引（“将手机放在桌面 / 指向工作时的正前方”），持续约2秒
- **等待阶段**: 然后切换到与初始指引完全相同的文案页面，但底部出现“继续”按钮，用户点击后才开始检测方向
- **方向检测**: 使用 `useDeviceOrientation` Hook监听设备方向变化
- **稳定性判断**: 检测设备方向在3秒内变化小于5度时判定为稳定
- **权限处理**: 自动检测并请求iOS Safari的设备方向权限
- **状态管理**: 管理检测阶段（intro/waiting/requesting/detecting/error）
- **数据存储**: 方向稳定后记录alpha角度到 `onboardingStore`
- **自动导航**: 方向稳定后立即跳转到加载页面（Loading 第1屏：准备就绪/开始演算）

## 依赖关系（Dependencies）
### 输入（INPUT）
- `react-router-dom` 的 `useNavigate`: 用于页面导航
- `constants/strings.ts` 的 `DSStrings`: 获取UI文本字符串
- `hooks/useDeviceOrientation.ts`: 设备方向检测Hook
  - 提供方向数据（alpha、beta、gamma）
  - 提供稳定性状态（isStable、stableDuration）
  - 提供监听控制函数（startListening、stopListening）
- `stores/onboardingStore.ts`: 存储方向数据（setOrientationDegrees）
- `utils/permissions.ts`: 权限请求函数
  - `requestOrientationPermission()`: 请求设备方向权限
  - `needsOrientationPermission()`: 检查是否需要请求权限
- `styles/variables.css`: CSS变量（颜色、字体、间距等）

### 输出（OUTPUT）
- 方向数据存储: 将稳定的方向角度（alpha）保存到 `onboardingStore`
- 导航至加载页面: 方向记录完成后自动跳转到 `/loading`

## 约束（Constraint）
- **严禁直接调用DeviceOrientationEvent**: 必须使用 `useDeviceOrientation` Hook
- **严禁硬编码阈值**: 稳定性阈值（5度、3秒）应通过Hook参数配置
- **必须处理权限拒绝**: iOS Safari权限被拒绝时显示错误提示
- **必须清理资源**: 组件卸载时自动停止监听
- **必须使用CSS变量**: 所有颜色、字体、间距必须使用CSS变量
- **必须遵循Figma设计**: 背景、字体、布局必须与设计稿一致

## 成员清单

- `OrientationCaptureView.tsx` - **Orientation Processor**: 方向获取页面组件
  - 显示箭头图标和指导文字
  - 处理继续按钮点击，请求权限并开始监听
  - 监听稳定性状态，自动记录方向并跳转
  - 处理错误状态，显示错误信息和重试按钮
  - 显示检测进度（稳定持续时间）
- `OrientationCaptureView.module.css` - **Orientation Styles**: 方向页面的样式文件
  - 使用与CaptureComplete相同的背景渐变和毛玻璃效果
  - 箭头图标动画（检测中的脉冲效果）
  - 进度条显示稳定持续时间
  - 响应式适配和安全区域适配

